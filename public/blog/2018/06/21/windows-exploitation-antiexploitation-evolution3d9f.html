<!doctype html>
<html amp lang="en" >
  
<!-- Mirrored from resources.xceptional.com/blog/2018/06/21/windows-exploitation-antiexploitation-evolution?hs_amp=true by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 23 Jan 2024 07:09:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Windows Exploitation and AntiExploitation Evolution</title>
    <link rel="canonical" href="windows-exploitation-antiexploitation-evolution.html" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <meta name="author" content="Natalie">

    <meta name="description" content="Windows Exploitation and AntiExploitation Evolution">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta name="generator" content="HubSpot">
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Windows Exploitation and AntiExploitation Evolution",
        "datePublished": "2018-06-21T17:24:49Z",
        "dateModified": "2021-11-09T02:23:00.121Z",
        "mainEntityOfPage": "https://resources.xceptional.com/blog/2018/06/21/windows-exploitation-antiexploitation-evolution",
        "author": {
          "@type": "Person",
          "name": "Natalie"
        },
        "image": {
         "@type": "ImageObject",
        
          "url": "/hs/hsstatic/content_shared_assets/static-1.4092/img/default-amp-logo.png",
          "width": 60,
          "height": 60
        
        },
        "publisher" : {
          "@type": "Organization",
          "logo": {
            "@type": "ImageObject",
            
            "url": "/hs/hsstatic/content_shared_assets/static-1.4092/img/default-amp-logo.png",
            "width": 60,
            "height": 60
            
          },
          "name": "The Xceptional Blog"
        }
      }
    </script>
    <script async custom-element="amp-analytics" src="../../../../../cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
    <noscript>
      <style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style>
    </noscript>
  <style amp-custom>
      body {
        color: #404040;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 18px;
        line-height: 1.6;
      }

      .hs-page-width-normal {
        box-sizing: content-box;
        margin: 0 auto;
        padding: 0 5vw 5vw;
      }

      .info {
        font-size: 14px
      }

      h1 {
        color: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 26px;
        line-height: 1.5;
        font-weight: 600;
      }

      h1 a {
        color: #404040;
      }

      h2 {
        color: #404040;
        font-size: 22px;
        line-height: 38px;
      }

      a {
        color: #416bb3;
        text-decoration: none;
      }

      .logo-header-text {
        color: #1e1e1e;
        font-size: 36px;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        line-height: 2.0;
        font-weight: bold;
        vertical-align: text-bottom;
      }

      .hs-page-width-normal {
        padding: 5vw;
      }

      .iframe-placeholder {
        background-color: #bbb;
      }

      .header-banner {
        padding: 3vw 1vw;
        border-color: #dcdcdc;
        border-bottom-style: solid;
        border-bottom-width: thin;
        background-color: #ffffff;
        color: #1e1e1e;
        text-align: center;
      }

      .full-link {
        text-align: center;
      }

      .full-link a {
        border: 1px solid #dcdcdc;
        background-color: transparent;
        color: #416bb3;
        cursor: pointer;
        display: block;
        font-size: 14px;
        line-height: 18px;
        margin: 0 auto;
        max-width: 200px;
        padding: 11px 16px;
        text-decoration: none;
        width: 50%;
      }

    </style>
    <script async src="../../../../../cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <div class="row-fluid">
      <div class="header-banner">
        <a class="blog-link" href="../../../../blog.html">
        
          <span class="logo-header-text">The Xceptional Blog</span>
         </a>
      </div>  
      <div class="hs-page-width-normal">
        <div class="post-header">
          <h1><a href="windows-exploitation-antiexploitation-evolution.html">Windows Exploitation and AntiExploitation Evolution</a></h1>
        </div>
        <div class="info">
          <span> Written by <a class="author-link" href="../../../author/andy.html">Natalie</a> | Jun 21, 2018 5:24:49 PM </span>
        </div>
        <div class="blog-section">
          <span><p>Windows has been a target of hackers for a long time. The reason is simple: it is the OS with the largest deployment footprint around the world. Hackers discover&nbsp;vulnerabilities in Windows OS software as well as the various software that support Windows OS. Exploits as well as exploit mitigation techniques have evolved over the years. Over time, the targeted exploit has shifted from server applications to desktop applications. Adobe Flash has been a favorite target for the past seven to eight years. In this article we will talk about the exploits and their mitigation techniques on Windows.</p> 
<p>Exploits are meant to compromise the system by taking advantage of a vulnerability in the program. Before moving ahead, let us first discuss how hackers find a vulnerability in an application.</p> 
<h3><span><strong>Common vulnerability&nbsp;discovery&nbsp;techniques</strong>:</span></h3> 
<p><strong>Fuzzing:&nbsp;</strong><strong>This</strong>&nbsp;is a common way to test for vulnerabilities. The hackers provide a large range of inputs for the target software and observe for any unexpected behavior. For browsers, a lot of HTML files are created as an input. If the vulnerability has not been seen earlier, it is called a&nbsp;<strong>zero</strong><strong>&nbsp;day vulnerability</strong>.</p> 
<p><strong>Patch diffing: This</strong>&nbsp;is a technique by which an update in software is compared with an old version. Windows used to update its software by means of DLLs. Hackers can compare the old and new DLL to find out what code is patched. After this, they can analyze it to find out if the old code is vulnerable. Hackers write the exploit to take advantage of the vulnerability assuming that not everybody would have applied the new software patch immediately. These kind of exploits are called&nbsp;<strong>one</strong><strong>&nbsp;day</strong>&nbsp;exploits.</p> 
<p><strong>Leaks:&nbsp;</strong>There are certain organizations that discover zero day vulnerabilities for commercial software testing. Hacking Team was one of these. Hacking Team exploits were leaked in 2015. Eternal Blue is also one of such infamous exploits that contributed to the spread of WannaCry and Petya malware</p> 
<h3><span><strong>Types of Vulnerabilities and Windows countermeasures</strong></span></h3> 
<p><strong>Buffer Overflow vulnerabilities</strong>: These kinds of vulnerabilities occur when a program doesn’t check the boundary of user-supplied data.&nbsp;<strong>Stack overflow</strong>&nbsp;and&nbsp;<strong>heap overflow</strong>&nbsp;are the most common types of buffer overflow. Windows has patched almost all known and exploitable buffer overflow vulnerabilities and it is rare to see a new one discovered these days.</p> 
<p>Other than patching the vulnerabilities in the software, Windows also developed some techniques to mitigate buffer overflows.</p> 
<p>A&nbsp;<strong>Stack</strong>&nbsp;is a a very important data structure used in programming. It is used to store<strong>&nbsp;local variables</strong>&nbsp;and the function&nbsp;<strong>return address</strong>.&nbsp;<strong>Local variables</strong>&nbsp;can store user supplied data. As an example, HTTP server can store the HTTP request sent by the user in a variable. If the server does not check the size of the supplied HTTP request, it gets written to the stack where it can corrupt other data like the&nbsp;<strong>return address</strong>. The return address can be overwritten to redirect the control flow to a<strong>&nbsp;shellcode</strong>&nbsp;which is part of the user supplied variable value. A shellcode can pop a backdoor, launch a program or download another malware. Stack overflow exploitation works by overwriting the&nbsp;<strong>return address</strong>on the stack by a user supplied&nbsp;<strong>local variable</strong>.</p> 
<p><span class="lia-inline-image-display-wrapper lia-image-align-center"><span class="lia-message-image-wrapper"><amp-img class="lia-media-image" src="../../../../../static.hsstatic.net/BlogImporterAssetsUI/ex/missing-image.png" alt="stack_overflow.png" width="415" height="411" layout="responsive"></amp-img><i></i></span></span></p> 
<p>Windows came up a with&nbsp;<strong>stack canaries</strong>&nbsp;to detect overwriting of the&nbsp;<strong>return address</strong><strong>.</strong>&nbsp;The<strong>&nbsp;stack canaries</strong>&nbsp;feature was implemented in&nbsp;<strong>Windows XP SP2.</strong>&nbsp; An<strong>&nbsp;exception</strong>&nbsp;was triggered when the return address was overwritten. Unfortunately, hackers bypassed this too using a technique called&nbsp;<strong>SEH Overwrite (Structured Exception Handler)</strong>. The address of the&nbsp;<strong>e</strong><strong>xceptional handler</strong>&nbsp;needed to handle the&nbsp;<strong>return address overwrite&nbsp;exception</strong>&nbsp;was stored on the stack. Hence, the attacker was able to take control by overwriting this value.</p> 
<p><strong>Heap overflow</strong>&nbsp;also worked in a similar manner. User supplied data was able to corrupt important data structures on the heap to take control of the program. To track heap allocation, linked lists are used. The pointers used to connect node in the linked list are corrupted and overwritten by user controlled code.</p> 
<p>Windows invented a technique called&nbsp;<strong>DEP (Data Execution Prevention)</strong>&nbsp;to prevent this kind of exploitation. The technique imposed a restriction that anything on the stack or heap should be treated as data and should not be executed.</p> 
<p><span class="lia-inline-image-display-wrapper lia-image-align-center"><span class="lia-message-image-wrapper"><amp-img class="lia-media-image" src="../../../../../static.hsstatic.net/BlogImporterAssetsUI/ex/missing-image.png" alt="dep.png" width="415" height="230" layout="responsive"></amp-img><i></i></span></span></p> 
<p><span><strong>DEP settings on windows</strong></span></p> 
<p><span class="lia-inline-image-display-wrapper lia-image-align-center"><span class="lia-message-image-wrapper"><amp-img class="lia-media-image" src="../../../../../static.hsstatic.net/BlogImporterAssetsUI/ex/missing-image.png" alt="ROP.png" width="584" height="410" layout="responsive"></amp-img><i></i></span></span></p> 
<p>In order to bypass DEP, attackers created the shellcode by using codes in DLLs, which are supposed to execute. The&nbsp;<strong>shellcode</strong>&nbsp;is composed of addresses of instructions inside a DLL instead of only instructions. This technique is called&nbsp;<strong>ROP chain</strong>&nbsp;(return oriented programming). The ROP technique executes the code chunks that span across multiple DLLs to carry out the same functionality, which could have also been achieved by executing a contiguous chunk of shellcode placed in a heap or stack in absence of DEP. The code chunks from the DLLs used in ROP are called&nbsp;<strong>ROP gadgets</strong>. It was possible to create a ROP chain by using addresses inside a loaded DLL as the DLL addresses were fixed. To mitigate this ROP, Windows introduced another technique called&nbsp;<strong>ASLR (Address Space Layout Randomization)</strong>. This technique randomized the base addresses of DLL with respect to the main executable each time the program started. This technique was quite effective with minimal flaws. The attacker used the non-randomized DLLs to create exploits. Attackers sometimes used another technique called&nbsp;<strong>information disclosure or information leak</strong>&nbsp;to find out the address of a DLL and then use the address in the exploit.</p> 
<p>Now, stack and heap overflow are rarely seen in popular applications. It seems that most companies have done a good job on educating engineers about basic vulnerabilities.&nbsp;<strong>Use-After-Free</strong>&nbsp;has been the most recent popular vulnerability. It’s one of the most exploited vulnerabilities in the past five to six years.It was found in all browsers, Adobe Reader and Adobe Flash applications. Use-After-Free is a<strong>&nbsp;memory corruption</strong>&nbsp;vulnerability. The vulnerability is triggered when the program tries to access an object that has been freed. The object has been freed, but there was still a pointer that pointed to the memory location of the freed object. Trying to access the data pointed to the leads of the vulnerability. This kind of pointer is called a d<strong>angling&nbsp;pointer</strong>. Attackers can misuse the pointer to execute shellcode. Microsoft introduced a technique called&nbsp;<strong>i</strong><strong>solated heap</strong>&nbsp;in mid-2014 to minimize use after free vulnerabilities. Isolated heap allocated separate heap for critical objects. The heap blocks are freed from user controlled data after the object is freed. Isolated heap helped to prevent exploitation of use-after-free vulnerabilities, but isolated heap was applied only to selective objects, not all objects. So, some objects might still be subject to risk. To further elevate the security, Microsoft added<strong>&nbsp;Protected Free&nbsp;</strong>or<strong>&nbsp;Deferred Free</strong>. In this technique, Microsoft does not free the object immediately. Instead, it frees it sometime later so that the attacker cannot predict the time when they can control the freed object.</p> 
<p>Another very popular technique used to exploit browsers is<strong>&nbsp;heap spray</strong>. JavaScript used in browsers stores variables in the heap. The heap spray technique was used to fill the heap with lots of shellcode chunks. The advantage of this technique is that the attacker does not need to accurately predict the address of shellcode on heap. An address like 0xaaaaaaaa ,0xbbbbbbbbb is used, which most likely points to the heap and the shellcode would then probably lie around that.&nbsp;<strong>Chromium sandbox</strong>&nbsp;was one of Google Chrome’s innovations to counter all kinds of browser exploitation. Internet Explorer also came up with a similar solution.</p> 
<p>But, still the DEP and ASLR was an issue. Hence, the novel technique&nbsp;<strong>JIT spray&nbsp;</strong>(<strong>Just In Time</strong>) was used. The technique was mostly used to exploit Flash-related vulnerabilities. JIT Engine is a native code generator, which is used by all modern browsers to speed up execution by parsing, optimizing and compiling bytecode to native code for the machine to run. The emitted code by JIT Engine is marked as executable in memory by default. This code can be sprayed into the heap by calculating the right size allocation of a page. After that, it’s a matter of jumping to a known heap address to get code execution bypassing DEP and ASLR all together. This bytecode can be generated in real time by JIT or it can be pre-generated and sent on the wire as a Flash/Java file on the internet. This technique was first used with Flash ActionScripts to spray heap, which used long XOR sequences to store shellcode and jumped onto a known heap address to get reliable code execution. After researchers were able to use the same JIT spray technique to exploit native JAVA and also used ASM.js recently for exploitation.</p> 
<p>To keep up with the continuously evolving exploit landscape, Microsoft came up with&nbsp;<strong>EMET</strong>&nbsp;(Enhanced Mitigation Experience Toolkit) in 2009. It is an added layer of defense against code reuse attacks like ROP and provides better protection against Heap and JIT spray. Though it has to be manually installed by an administrator. Since EMET was not designed as an integral part of the OS, the exploit writers were able to bypass/disable EMET and achieve code execution in each of its versions. Though EMET led many security innovation in Windows product lines 7, 8 ,8.1, 10 and it’s Linux counterparts. As underlying OS changed, Microsoft decided to build in this security in OS as&nbsp;<strong>Windows Defender Exploit Guard,</strong>&nbsp;which will support future Windows versions after Windows 10, with many improvements. Microsoft decided to end life support for EMET. The latest version will be&nbsp;<strong>EOL’d on July 31, 2018.</strong></p> 
<h3><span><strong>CONCLUSION</strong></span></h3> 
<p>Exploitation and Anti-Exploitation techniques is almost a cat and rat race. Security professionals always come up with an idea to combat Cyber criminals but at the same time criminals figure out a way to defeat it.</p> 
<p>&nbsp;</p> 
<p><amp-img class="wp-image-6143 alignleft" src="../../../../hs-fs/hubfs/Imported_Blog_Media/777022788-313c8.jpg?width=99&amp;height=99&amp;name=777022788-3.jpg" alt="" width="99" height="99" srcset="https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/777022788-3.jpg?width=50&amp;height=50&amp;name=777022788-3.jpg 50w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/777022788-3.jpg?width=99&amp;height=99&amp;name=777022788-3.jpg 99w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/777022788-3.jpg?width=149&amp;height=149&amp;name=777022788-3.jpg 149w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/777022788-3.jpg?width=198&amp;height=198&amp;name=777022788-3.jpg 198w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/777022788-3.jpg?width=248&amp;height=248&amp;name=777022788-3.jpg 248w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/777022788-3.jpg?width=297&amp;height=297&amp;name=777022788-3.jpg 297w"></amp-img>&nbsp;By Abhijit Mohanta</p> 
<p>Published with permission from&nbsp;forums.juniper.net/t5/Blogs/ct-p/blogs</p></span>
        </div>
        <div class="full-link">
          <a href="windows-exploitation-antiexploitation-evolution.html">View full post</a>
        </div>
      </div>
    </div>
    
    <amp-pixel src="../../../../../track.hubspot.com/__ptqbfc5.gif?cd=SCREEN_COLOR_DEPTH-bit&amp;cs=DOCUMENT_CHARSET&amp;ln=BROWSER_LANGUAGE&amp;sd=AVAILABLE_SCREEN_WIDTHxAVAILABLE_SCREEN_HEIGHT&amp;v=1.1&amp;iaa=1&amp;k=1&amp;ccu=CANONICAL_URL&amp;r=DOCUMENT_REFERRER&amp;ct=blog-post&amp;t=Windows+Exploitation+and+AntiExploitation+Evolution&amp;pi=50503647853&amp;a=6853069&amp;nc=true&amp;cgi=23291088092&amp;lvi=50503647853&amp;lvc=en&amp;vi=CLIENT_ID(hubspotutk)&amp;ai=CLIENT_ID(amputk)">
    </amp-pixel>
    
  </body>

<!-- Mirrored from resources.xceptional.com/blog/2018/06/21/windows-exploitation-antiexploitation-evolution?hs_amp=true by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 23 Jan 2024 07:09:49 GMT -->
</html>
