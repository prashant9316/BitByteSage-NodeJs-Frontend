<!doctype html>
<html amp lang="en" >
  
<!-- Mirrored from resources.xceptional.com/blog/2018/06/14/vpnfilter-global-threat-beyond-routers?hs_amp=true by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 23 Jan 2024 07:10:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>VPNFilter: a global threat beyond routers</title>
    <link rel="canonical" href="vpnfilter-global-threat-beyond-routers.html" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <meta name="author" content="Natalie">

    <meta name="description" content="VPNFilter: a global threat beyond routers">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta name="generator" content="HubSpot">
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "VPNFilter: a global threat beyond routers",
        "datePublished": "2018-06-14T17:31:55Z",
        "dateModified": "2021-11-09T02:16:44.453Z",
        "mainEntityOfPage": "https://resources.xceptional.com/blog/2018/06/14/vpnfilter-global-threat-beyond-routers",
        "author": {
          "@type": "Person",
          "name": "Natalie"
        },
        "image": {
         "@type": "ImageObject",
        
          
          
          "url": "https://f.hubspotusercontent10.net/hubfs/6853069/Imported_Blog_Media/2295496814-3.jpg"
        
        },
        "publisher" : {
          "@type": "Organization",
          "logo": {
            "@type": "ImageObject",
            
            "url": "/hs/hsstatic/content_shared_assets/static-1.4092/img/default-amp-logo.png",
            "width": 60,
            "height": 60
            
          },
          "name": "The Xceptional Blog"
        }
      }
    </script>
    <script async custom-element="amp-analytics" src="../../../../../cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
    <noscript>
      <style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style>
    </noscript>
  <style amp-custom>
      body {
        color: #404040;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 18px;
        line-height: 1.6;
      }

      .hs-page-width-normal {
        box-sizing: content-box;
        margin: 0 auto;
        padding: 0 5vw 5vw;
      }

      .info {
        font-size: 14px
      }

      h1 {
        color: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 26px;
        line-height: 1.5;
        font-weight: 600;
      }

      h1 a {
        color: #404040;
      }

      h2 {
        color: #404040;
        font-size: 22px;
        line-height: 38px;
      }

      a {
        color: #416bb3;
        text-decoration: none;
      }

      .logo-header-text {
        color: #1e1e1e;
        font-size: 36px;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        line-height: 2.0;
        font-weight: bold;
        vertical-align: text-bottom;
      }

      .hs-page-width-normal {
        padding: 5vw;
      }

      .iframe-placeholder {
        background-color: #bbb;
      }

      .header-banner {
        padding: 3vw 1vw;
        border-color: #dcdcdc;
        border-bottom-style: solid;
        border-bottom-width: thin;
        background-color: #ffffff;
        color: #1e1e1e;
        text-align: center;
      }

      .full-link {
        text-align: center;
      }

      .full-link a {
        border: 1px solid #dcdcdc;
        background-color: transparent;
        color: #416bb3;
        cursor: pointer;
        display: block;
        font-size: 14px;
        line-height: 18px;
        margin: 0 auto;
        max-width: 200px;
        padding: 11px 16px;
        text-decoration: none;
        width: 50%;
      }

    </style>
    <script async src="../../../../../cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <div class="row-fluid">
      <div class="header-banner">
        <a class="blog-link" href="../../../../blog.html">
        
          <span class="logo-header-text">The Xceptional Blog</span>
         </a>
      </div>  
      <div class="hs-page-width-normal">
        <div class="post-header">
          <h1><a href="vpnfilter-global-threat-beyond-routers.html">VPNFilter: a global threat beyond routers</a></h1>
        </div>
        <div class="info">
          <span> Written by <a class="author-link" href="../../../author/andy.html">Natalie</a> | Jun 14, 2018 5:31:55 PM </span>
        </div>
        <div class="blog-section">
          <span><p>When first publicly announced on May 23, the threat dubbed&nbsp;<a href="https://forums.juniper.net/t5/Threat-Research/VPNFilter-a-nation-state-campaign-for-surveillance-and/ba-p/327038" target="_blank" rel="noopener noreferrer">VPNFilter</a>&nbsp;was thought to only infect some brands of home routers and Network Attached Storage devices. While it was known that the list of router brands was probably not complete, little did we know that the malware has the ability to infect the very computers sitting behind those routers and firewalls.</p> 
<p>Continuing on their initial investigation of this threat, Cisco Talos shared with the&nbsp;<a href="https://www.cyberthreatalliance.org/" target="_blank" rel="nofollow noopener noreferrer">Cyber Threat Alliance</a>, of which Juniper Networks is an affiliate member, additional malware samples and&nbsp;<a href="https://blog.talosintelligence.com/2018/06/vpnfilter-update.html" target="_blank" rel="nofollow noopener noreferrer">analysis</a>&nbsp;gathered since the initial reports on this threat. Several key findings emerge:</p> 
<ol> 
 <li><strong>The list of affected router brands continues to grow, but is still limited to brands covering the small office / home office segment of the market.</strong>&nbsp;No enterprise brands are affected. Juniper Networks routers are not believed to be affected.</li> 
 <li><strong>The malware can infect devices behind an infected router by injecting content into web traffic and attempting to exploit the endpoints.</strong>&nbsp;This does not mean it will be successful at the exploitation attempt. It&nbsp;solely&nbsp;means that the exploit is attempted without a user having to visit a compromised site, click on a malicious link or open a malicious email attachment.</li> 
 <li><strong>The malware has a stage 3 module that can render the infected device inoperable.</strong>&nbsp;This was initially thought to only exist in a stage 2 malware, but it seems some stage 3 module provides the same ability. This leads us to believe that in earlier times of this campaign, the stage 2 malware did not have this capability and was only introduced more recently. So to cover the early infection, this stage 3 module capability was added.</li> 
</ol> 
<p>Let’s review these findings in more detail.</p> 
<p><strong>Affected edge devices</strong></p> 
<p>The initial list of targeted routers included MicroTik, Linksys, NetGear and TPLink. It is now expanded to include devices from ASUS, D-Link, Huawei, Ubiquiti, UPVEL and ZTE. We still do not believe this list is complete as more infected devices are being discovered. There is still no sign of any zero day vulnerability being exploited, so it is likely that known vulnerabilities and weak passwords are the main vector of infection.</p> 
<p><strong>Endpoint infection</strong></p> 
<p>This new stage 3 module dubbed 'ssler' has the ability to intercept all network traffic destined for port 80 and selectively inject exploits for the endpoint via JavaScript. This man-in-the-middle attack is based on the following variables:</p> 
<ul> 
 <li>Source IP: this is the endpoint IP that is making the http request. The fact that the source IP is an option means the threat actor has potentially profiled endpoints behind the firewall and knows which endpoint to target with the exploits.</li> 
 <li>Destination IP: this allows the threat actor to focus on certain communications of interest, for example with your bank or your cloud email service, and siphon off the credentials that are used to authenticate.</li> 
 <li>Visited sites: this is similar to the destination IP above, except that it uses the domain name instead of its IP, which allows targeting of services distributed around the world.</li> 
</ul> 
<p>The injected script itself is highly customizable since it is downloaded from a remote location. It can therefore be updated at any time to tailor its activity to a particular need.</p> 
<p>This malware module also accepts a ‘dump’ parameter which specifies some websites&nbsp;as where the threat actor wants to dump all the connection parameters into a local file, like the full URL, the port, all request headers, presumably for the purpose of exfiltrating it to a C2 server. Additionally, even if the website is not specifically listed in the dump parameters but the communication contains interesting strings,&nbsp;such as&nbsp;authorization in the headers or some keywords related to passwords in the URL (like assword, sername, ogin), the dump of the connection parameter will take place. Notice the missing first letter. This is a way to avoid dealing with uppercase and lowercase parameter names.</p> 
<p>To accomplish persistence of the injection module, the technique of routing all traffic from port 80 to the malware’s own listening service is deleted and recreated every four minutes. This is because any reconfiguration on the router by its owner tends to rewrite the entire configuration from an in-memory previous configuration, which would remove any routes the malware has added. Furthermore, some routers use counters on the routes, query them every few minutes and clear these counters, which is also done by rewriting the configuration. Therefore, this malware module found it easier to deal with this uncertainty by running the man-in-the-middle attack every few minutes.</p> 
<p>One interesting feature of the malware is the fact that it turns any secure HTTPS into an insecure HTTP connection on the fly. This will allow it to peek into the contents of all connections. Most web sites today will redirect HTTP to HTTPS connections, but it is enough sometimes to catch the very first request as it may already contain credentials and other POST form elements. As a matter of fact, this malware will only perform this operation once per web site every 4 days, after which HTTPS connection to those “whitelisted” web sites are left alone. Four domains are explicitly excluded from this inspection: google.com, youtube.com, facebook.com and twitter.com.</p> 
<p>In order to keep the parsing of the&nbsp;HTTP protocol as simple as possible, the malware module changes any connection parameter - connection:keep-alive to connection:close. It also changes any accept-encoding request header to not contain a gzip parameter. This allows the malware to inspect content without having to decompress it, which keeps the size of the malware module to a minimum.</p> 
<p><strong>Destructive capability</strong></p> 
<p>New insight into the destructive capability of this new stage 3 module shows that the threat actors went to a great length to make sure the destruction is successful and irreversible. We can now see that the module:</p> 
<ul> 
 <li>Deletes itself from memory</li> 
 <li>Stops execution of its stage 2 parent process</li> 
 <li>Stops execution of any process with a name containing vpnfilter, tor or security</li> 
 <li>Deletes a list of files related to its own operation</li> 
 <li>Overwrites the flash memory with a 0xFF byte, which is something similar to what the stage 2 destroyer does based on our&nbsp;<a href="https://forums.juniper.net/t5/Threat-Research/VPNFilter-a-nation-state-campaign-for-surveillance-and/ba-p/327038" rel="noopener noreferrer">previous post on this topic</a>.</li> 
 <li>Deletes all files on the router’s file systems by issuing a rm /* command.</li> 
 <li>Triggers a reboot of the device, which after everything above will certainly fail permanently.</li> 
</ul> 
<p><strong>Conclusion</strong></p> 
<p>It is obvious that the scope of this campaign is far bigger than initially thought. The ability to infect endpoints introduces a new variable and the clean up process is more involved than just rebooting routers. Any exploit could have been used by the threat actors to target the computers behind infected routers.</p> 
<p>At this point, it is important for people who had routers in the list of affected devices to make sure they have the following&nbsp;mitigations in place:</p> 
<ol> 
 <li>Make sure you have an updated anti-virus software running on&nbsp;your endpoints.</li> 
 <li>Make sure your systems are up-to-date with any security patches.</li> 
 <li>Enable two factor authentication on all online accounts that support it.</li> 
</ol> 
<p>As our research progresses, we will publish any additional guidance to&nbsp;thwart this infection. In the meantime, Juniper SRX firewall devices are updated to detect any infection attempt from VPNfilter based on the IOCs known to the Cyber Threat Alliance.</p> 
<p>&nbsp;</p> 
<p><amp-img class="wp-image-6186 alignleft" src="../../../../hs-fs/hubfs/Imported_Blog_Media/2295496814-3ded8.jpg?width=95&amp;height=95&amp;name=2295496814-3.jpg" alt="" width="95" height="95" srcset="https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/2295496814-3.jpg?width=48&amp;height=48&amp;name=2295496814-3.jpg 48w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/2295496814-3.jpg?width=95&amp;height=95&amp;name=2295496814-3.jpg 95w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/2295496814-3.jpg?width=143&amp;height=143&amp;name=2295496814-3.jpg 143w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/2295496814-3.jpg?width=190&amp;height=190&amp;name=2295496814-3.jpg 190w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/2295496814-3.jpg?width=238&amp;height=238&amp;name=2295496814-3.jpg 238w, https://resources.xceptional.com/hs-fs/hubfs/Imported_Blog_Media/2295496814-3.jpg?width=285&amp;height=285&amp;name=2295496814-3.jpg 285w"></amp-img>&nbsp;By Mounir Hahad</p> 
<p>Published with permission from&nbsp;forums.juniper.net/t5/Blogs/ct-p/blogs</p></span>
        </div>
        <div class="full-link">
          <a href="vpnfilter-global-threat-beyond-routers.html">View full post</a>
        </div>
      </div>
    </div>
    
    <amp-pixel src="../../../../../track.hubspot.com/__ptqd6cc.gif?cd=SCREEN_COLOR_DEPTH-bit&amp;cs=DOCUMENT_CHARSET&amp;ln=BROWSER_LANGUAGE&amp;sd=AVAILABLE_SCREEN_WIDTHxAVAILABLE_SCREEN_HEIGHT&amp;v=1.1&amp;iaa=1&amp;k=1&amp;ccu=CANONICAL_URL&amp;r=DOCUMENT_REFERRER&amp;ct=blog-post&amp;t=VPNFilter%3A+a+global+threat+beyond+routers&amp;pi=50503646894&amp;a=6853069&amp;nc=true&amp;cgi=23291088092&amp;lvi=50503646894&amp;lvc=en&amp;vi=CLIENT_ID(hubspotutk)&amp;ai=CLIENT_ID(amputk)">
    </amp-pixel>
    
  </body>

<!-- Mirrored from resources.xceptional.com/blog/2018/06/14/vpnfilter-global-threat-beyond-routers?hs_amp=true by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 23 Jan 2024 07:10:44 GMT -->
</html>
